<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">

<link rel="import" href="../iron-data-table/iron-data-table.html">
<link rel="import" href="../oc-grid-controls/oc-grid-controls.html">
<link rel="import" href="../oc-product-option-api/oc-product-option-api.html">

<!--
`oc-option-sets-list`
Element displaying a list of option sets

@demo demo/index.html
-->

<dom-module id="oc-option-sets-list">
  <style>
    :host {
      display: block;
    }
    paper-material {
      background-color: #fff;
      padding: 10px;
    }
    .new-option-set-button {
      margin: 10px;
    }
  </style>

  <template>

    <oc-product-option-api id="optionsApi" ></oc-product-option-api>

    <paper-material>
      <paper-button class="new-option-set-button" on-tap="_onCreateTapped">New Option Set</paper-button>
      <oc-grid-controls data="[[ _optionSets ]]" total-count="[[ _optionSetsCount ]]">
        <iron-data-table>
          <data-table-column name="Name" sort-by="name">
            <template>[[item.name]]</template>
          </data-table-column>
          <data-table-column name="Display Name" sort-by="displayName">
            <template>[[item.displayName]]</template>
          </data-table-column>
          <data-table-column name="Options" sort-by="options">
            <template is="dom-repeat" item="[[item.options]]" as="option">[[option.name]]</template>
          </data-table-column>
          <data-table-column name="Enabled" sort-by="enabled">
            <template>
              <paper-checkbox checked="[[item.enabled]]" on-change="_enabledHandler"></paper-checkbox>
            </template>
          </data-table-column>
          <data-table-column name="Actions">
            <template>
              <div data-option-object$="[[ item ]]">
                <paper-icon-button id="edit" icon="create" title="Edit Set"  on-tap="_actionHandler"></paper-icon-button>
                <paper-icon-button id="clone" icon="content-copy" title="Clone Set" on-tap="_actionHandler"></paper-icon-button>
              </div>
            </template>
          </data-table-column>
        </iron-data-table>
      </oc-grid-controls>
    </paper-material>
  </template>

  <script>
    Polymer({

      is: 'oc-option-sets-list',

      properties: {
        organisationId: Number,
        loading: {
          type: Boolean,
          value: false,
          notify: true
        }
      },

      observers: [
        'refresh(organisationId)'
      ],

      refresh: function() {
        this.loading = true;
        this.$.optionsApi.getOptionSets()
                .then(function(request) {
                  this._optionSets = request.response.results;
                  this._optionSetsCount = request.response.count;
                }.bind(this))
                .catch(this.fire.bind(this, 'option-set-error', 'Failed to load option sets'))
                .finally(this.set.bind(this, 'loading', false));
      },

      _onCreateTapped: function() {
        this.fire('create');
      },

      _actionHandler : function(e) {
        var optionObj = JSON.parse(Polymer.dom(event).localTarget.parentElement.getAttribute('data-option-object')),
                action = e.target.getAttribute('id');
        this.fire(action, optionObj);
      }
    });
  </script>
</dom-module>
